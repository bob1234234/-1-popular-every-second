local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Window = Rayfield:CreateWindow({
    Name = "DUELS - Murderers VS Sheriffs",
    LoadingTitle = "Loading DUELS Script...",
    LoadingSubtitle = "by YourName",
    ConfigurationSaving = { Enabled = false },
    Discord = { Enabled = false },
    KeySystem = false,
})

-- === Variables to control toggles ===
local espEnabled = false
local silentAimEnabled = false
local autoKnifeEnabled = false
local autoKitEnabled = false

-- === ESP Implementation ===
local espObjects = {}

local function createESP(player)
    if player == LocalPlayer then return end
    local box = Instance.new("BoxHandleAdornment")
    box.Adornee = nil
    box.Color3 = Color3.new(1, 0, 0)
    box.AlwaysOnTop = true
    box.ZIndex = 10
    box.Size = Vector3.new(4, 6, 1)
    box.Transparency = 0.5
    box.Parent = workspace

    local nameTag = Instance.new("BillboardGui")
    nameTag.Adornee = nil
    nameTag.AlwaysOnTop = true
    nameTag.Size = UDim2.new(0, 100, 0, 20)
    nameTag.StudsOffset = Vector3.new(0, 3, 0)
    nameTag.Parent = workspace

    local label = Instance.new("TextLabel")
    label.Text = player.Name
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1, 1, 1)
    label.Size = UDim2.new(1, 0, 1, 0)
    label.Parent = nameTag

    espObjects[player] = {box = box, nameTag = nameTag}

    local function update()
        if not espEnabled then
            box.Adornee = nil
            nameTag.Adornee = nil
            nameTag.Enabled = false
            return
        end
        local character = player.Character
        if character and character:FindFirstChild("HumanoidRootPart") then
            box.Adornee = character.HumanoidRootPart
            nameTag.Adornee = character.HumanoidRootPart
            box.Size = Vector3.new(4, 6, 1)
            box.Transparency = 0.5
            nameTag.Enabled = true
        else
            box.Adornee = nil
            nameTag.Adornee = nil
            nameTag.Enabled = false
        end
    end

    return RunService.Heartbeat:Connect(update)
end

local espConnections = {}

local function enableESP(value)
    espEnabled = value
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if not espConnections[player] then
                espConnections[player] = createESP(player)
            end
        end
    else
        for player, esp in pairs(espObjects) do
            esp.box.Adornee = nil
            esp.nameTag.Adornee = nil
            esp.nameTag.Enabled = false
        end
        for _, connection in pairs(espConnections) do
            connection:Disconnect()
        end
        espConnections = {}
    end
end

Players.PlayerAdded:Connect(function(player)
    if espEnabled then
        espConnections[player] = createESP(player)
    end
end)

Players.PlayerRemoving:Connect(function(player)
    if espConnections[player] then
        espConnections[player]:Disconnect()
        espConnections[player] = nil
    end
    if espObjects[player] then
        if espObjects[player].box then espObjects[player].box:Destroy() end
        if espObjects[player].nameTag then espObjects[player].nameTag:Destroy() end
        espObjects[player] = nil
    end
end)

-- === Silent Aim Skeleton ===
local function getClosestTarget()
    local closestPlayer = nil
    local shortestDistance = math.huge
    local centerX, centerY = Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2

    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local pos, onScreen = Camera:WorldToViewportPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(centerX, centerY)).Magnitude
                if dist < shortestDistance then
                    shortestDistance = dist
                    closestPlayer = player
                end
            end
        end
    end
    return closestPlayer
end

local silentAimConnection

local function toggleSilentAim(value)
    silentAimEnabled = value
    if silentAimEnabled then
        -- Placeholder: Implement hooking with game shooting system
        print("[Silent Aim] ENABLED - Implement hook here")
    else
        if silentAimConnection then
            silentAimConnection:Disconnect()
            silentAimConnection = nil
        end
        print("[Silent Aim] DISABLED")
    end
end

-- === Auto Knife ===
local autoKnifeThread

local function toggleAutoKnife(value)
    autoKnifeEnabled = value
    if autoKnifeEnabled then
        autoKnifeThread = task.spawn(function()
            while autoKnifeEnabled do
                local character = LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    for _, player in pairs(Players:GetPlayers()) do
                        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                            local distance = (character.HumanoidRootPart.Position - player.Character.HumanoidRootPart.Position).Magnitude
                            if distance < 5 then
                                print("Auto Knife attacking:", player.Name)
                                -- Example remote event:
                                -- game:GetService("ReplicatedStorage").KnifeEvent:FireServer(player.Character.HumanoidRootPart)
                            end
                        end
                    end
                end
                task.wait(0.5)
            end
        end)
    else
        autoKnifeEnabled = false
        if autoKnifeThread then
            autoKnifeThread = nil
        end
    end
end

-- === Auto Kit Selection ===
local function selectKit()
    print("Auto kit selection triggered (replace with actual event call)")
    -- Example:
    -- game:GetService("ReplicatedStorage").SelectKit:FireServer("Sheriff")
end

local autoKitConnection

local function toggleAutoKit(value)
    autoKitEnabled = value
    if autoKitEnabled then
        if not autoKitConnection then
            autoKitConnection = LocalPlayer.CharacterAdded:Connect(function()
                task.wait(1)
                selectKit()
            end)
        end
        if LocalPlayer.Character then
            selectKit()
        end
    else
        if autoKitConnection then
            autoKitConnection:Disconnect()
            autoKitConnection = nil
        end
    end
end

-- === GUI Tabs & Toggles ===
local FeaturesTab = Window:CreateTab("Features", 4483362458)

FeaturesTab:CreateToggle({
    Name = "ESP",
    CurrentValue = false,
    Callback = enableESP,
})

FeaturesTab:CreateToggle({
    Name = "Silent Aim (Placeholder)",
    CurrentValue = false,
    Callback = toggleSilentAim,
})

FeaturesTab:CreateToggle({
    Name = "Auto Knife",
    CurrentValue = false,
    Callback = toggleAutoKnife,
})

FeaturesTab:CreateToggle({
    Name = "Auto Kit Select",
    CurrentValue = false,
    Callback = toggleAutoKit,
})

print("DUELS - Murderers VS Sheriffs script loaded. Use toggles to enable features.")
